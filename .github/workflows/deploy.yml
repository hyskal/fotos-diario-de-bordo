name: ğŸ”¥ Deploy to Firebase Hosting

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install Firebase CLI
      run: npm install -g firebase-tools
      
    - name: ğŸ§ª Validate Project Files
      run: |
        echo "ğŸ” Checking project structure..."
        ls -la
        echo "âœ… Validating required files:"
        test -f index.html && echo "  âœ… index.html found" || (echo "  âŒ index.html missing" && exit 1)
        test -f style.css && echo "  âœ… style.css found" || (echo "  âŒ style.css missing" && exit 1)
        test -f app.js && echo "  âœ… app.js found" || (echo "  âŒ app.js missing" && exit 1)
        test -f firebase.json && echo "  âœ… firebase.json found" || (echo "  âŒ firebase.json missing" && exit 1)
        echo "ğŸ‰ All required files validated!"
        
    - name: ğŸš€ Deploy to Firebase Hosting
      run: |
        firebase deploy --only hosting --token ${{ secrets.FIREBASE_TOKEN }} --project diario-de-bordo-cetep
      env:
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        
    - name: ğŸ‰ Deployment Success
      run: |
        echo "ğŸ‰ Deploy completed successfully!"
        echo "ğŸŒ Live URL: https://diario-de-bordo-cetep.web.app"
        echo "ğŸ“… Deployed at: $(date)"
        echo "ğŸ”— Commit SHA: ${{ github.sha }}"
        echo "ğŸ‘¤ Triggered by: ${{ github.actor }}"
